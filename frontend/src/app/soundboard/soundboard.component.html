<app-header pageTitle="Soundboard"></app-header>
<mat-toolbar class="title-row">
  <div class="toolbar-content-wrapper">
    <mat-form-field appearance="outline" matTooltip="Which category of sounds to display">
      <mat-label>Category</mat-label>
      <mat-select [ngModel]="settings.soundCategory$ | async" (ngModelChange)="settings.soundCategory$.next($event)">
        <mat-option value="">-- All --</mat-option>
        <mat-option *ngFor="let category of soundCategories$ | async" [value]="category">{{ category }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" *ngIf="(settings.soundTarget$ | async) === 'discord'">
      <mat-label>Discord Server</mat-label>
      <mat-select [ngModel]="settings.guildId$ | async" (ngModelChange)="settings.guildId$.next($event)">
        <mat-option *ngFor="let guild of guilds$ | async" [value]="guild.id">{{ guild.name || guild.id }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-button-toggle-group
      [ngModel]="settings.soundTarget$ | async"
      (ngModelChange)="stopLocalSound$.next(); settings.soundTarget$.next($event)"
      matTooltip="Play locally in the browser or via discord"
    >
      <mat-button-toggle value="local">Local</mat-button-toggle>
      <mat-button-toggle value="discord">Discord</mat-button-toggle>
    </mat-button-toggle-group>
    <mat-button-toggle
      [checked]="settings.debug$ | async"
      (change)="settings.debug$.next($event.source.checked)"
      matTooltip="Display additional information when playing sound"
      ><mat-icon>info</mat-icon></mat-button-toggle
    >
  </div>
</mat-toolbar>
<mat-toolbar class="controls-row">
  <div class="toolbar-content-wrapper">
    <mat-form-field class="controls-left">
      <mat-label>Search sounds...</mat-label>
      <input
        matInput
        [ngModel]="soundSearchFilter$ | async"
        (ngModelChange)="soundSearchFilter$.next($event)"
        (keydown.enter)="playFirstMatch$.next()"
      />
      <button mat-icon-button matSuffix (click)="soundSearchFilter$.next('')" [class.invisible]="(soundSearchFilter$ | async) === ''"
        ><mat-icon>clear</mat-icon></button
      >
      <mat-hint>ENTER plays the first result</mat-hint>
    </mat-form-field>

    <div class="controls-right">
      <div *ngIf="(settings.soundTarget$ | async) === 'local'" class="volume-slider-wrapper">
        <mat-icon>volume_up</mat-icon>
        <mat-slider
          [value]="settings.localVolume$ | async"
          (change)="settings.localVolume$.next($event)"
          color="primary"
          min="0"
          max="100"
          thumbLabel
        ></mat-slider>
      </div>
      <button mat-button (click)="stopSound$.next()"><mat-icon>stop</mat-icon> Stop</button>
    </div>
  </div>
</mat-toolbar>

<main class="max-width">
  <ng-container *ngIf="sounds$ | async; else loading">
    <div class="button-container">
      <ng-container *ngIf="(soundSearchFilter$ | async).length === 0">
        <app-soundboard-button *ngFor="let infix of randomInfixes$ | async" (click)="playInfix$.next(infix)"
          ><mat-icon>shuffle</mat-icon> RANDOM {{ infix | uppercase }}</app-soundboard-button
        >
      </ng-container>
      <app-soundboard-button
        *ngFor="let sound of filteredSounds$ | async; trackBy: trackByName"
        (click)="playSound$.next(sound)"
        [category]="sound.category"
        >{{ sound.name }}</app-soundboard-button
      >
    </div>
  </ng-container>
  <ng-template #loading>
    <div class="loading-wrapper">
      <mat-spinner></mat-spinner>
    </div>
  </ng-template>
</main>

<app-footer></app-footer>
